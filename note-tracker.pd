#N canvas 640 -959 1184 886 10;
#X obj 510 70 text define \$1;
#X text 510 97 \$1 is the text store name;
#X obj 110 50 inlet;
#X text 160 50 Pitch and velocity pair;
#X obj 110 75 t a a;
#X obj 167 242 list store;
#X obj 50 470 list store;
#X obj 70 120 unpack f f;
#X obj 93 153 sel 0;
#X text 510 250 With thanks to Critter & Guitari's cg-note-tracker
\, which can be found in the Pink Mode pattern.;
#X obj 167 211 t b;
#X obj 167 382 text insert \$1 1e+09;
#X obj 169 114 t a a a;
#N canvas 41 131 725 467 delete-entry 0;
#X obj 70 30 inlet;
#X text 120 30 Pitch and velocity pair;
#X obj 70 55 unpack f f;
#X obj 70 80 text search \$1;
#X obj 70 179 text delete \$1;
#X obj 70 109 select -1;
#X text 210 80 Given a pitch/velocity pair \, delete the line with
that pitch.;
#X text 120 144 Only delete if we have found a line;
#X connect 0 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 5 0;
#X connect 5 1 4 0;
#X restore 216 295 pd delete-entry;
#X text 241 242 Store the note pair in case it's note on;
#X text 130 469 Store the note pair in case it's note off;
#X text 290 357 Add extra values and insert the line;
#X obj 50 430 t b;
#X obj 50 639 text set \$1;
#X text 310 590 Value \, line number \, field number;
#X obj 288 91 r beat-clock;
#X obj 288 116 t b;
#X obj 288 160 f 0;
#X obj 330 160 + 1;
#X floatatom 270 210 20 0 0 0 - - -, f 20;
#X obj 330 185 s beat-count-\$0;
#X obj 330 130 r beat-count-\$0;
#X obj 167 267 t a b a;
#X obj 187 319 v beat-count-\$0;
#N canvas 448 160 906 450 get-note-duration 0;
#X obj 70 50 inlet;
#X text 120 50 Pitch and velocity pair;
#X text 340 50 \$1 is the text store name;
#X obj 76 217 -;
#X obj 20 120 v beat-count-\$0;
#X obj 76 322 outlet;
#X obj 130 120 find-line \$1;
#X obj 70 75 t b a b;
#X obj 250 110 t 0;
#X obj 76 262 spigot 0;
#X obj 130 170 t a 1;
#X text 340 90 Output the duration of a note \, which is the beat count
now minus the beat count from note-on. The second outlet bangs if there
is not record of the note-on.;
#X obj 204 260 outlet;
#X text 100 283 Only output if we've found the note;
#X obj 130 145 text get \$1 2;
#X connect 0 0 7 0;
#X connect 3 0 9 0;
#X connect 4 0 3 0;
#X connect 6 0 14 0;
#X connect 7 0 4 0;
#X connect 7 1 6 0;
#X connect 7 2 8 0;
#X connect 8 0 9 1;
#X connect 9 0 5 0;
#X connect 10 0 3 1;
#X connect 10 1 9 1;
#X connect 14 0 10 0;
#X connect 14 1 12 0;
#X restore 50 589 pd get-note-duration;
#X obj 50 545 t a a b;
#X obj 190 590 find-line \$1;
#X text 510 120 Text stores pitch \, velocity \, note duration \, tape
duration \, tape number (starts from 0).;
#X text 510 160 Note on writes an entry with dummy note duration set
at the current beat clock count \, tape duration has dummy value -99
and tape number has dummy value -1;
#X obj 167 357 pack f f 0 -99 -1;
#X obj 276 590 f 2;
#X obj 520 640 text set \$1;
#X text 780 591 Value \, line number \, field number;
#X obj 660 590 find-line \$1;
#X obj 50 495 t a a;
#N canvas 491 -1086 1156 914 get-next-tape-num 1;
#X obj 80 50 inlet;
#X text 430 50 \$1 is the text store name;
#X text 130 50 Bang;
#X obj 87 247 f 0;
#X obj 67 214 until;
#X obj 140 250 + 1;
#X obj 40 30 bng 15 250 50 0 empty empty empty 17 7 0 10 #fcfcfc #000000
#000000;
#X obj 88 420 f;
#X text 148 420 The value we searched for;
#X obj 88 370 select -1;
#X obj 88 395 t b;
#X text 138 390 We didn't find it \, so output it;
#X obj 73 496 f;
#X obj 510 435 text insert mytest;
#X obj 510 220 text define mytest;
#X text 140 180 Initial values \, incl -1 if not found;
#X obj 80 180 t 6 0 -1;
#X obj 53 107 t b b;
#X text 103 496 Save up a value \, output it at the end;
#X obj 87 276 t f f;
#X msg 510 384 list 0 0 0 0 5 \, list 0 0 0 0 2 \, list 0 0 0 0 1 \,
list 0 0 0 0 4 \, list 0 0 0 0 0 \, list 0 0 0 0 3;
#X text 510 190 Data for testing;
#X obj 510 551 text insert mytest;
#X msg 510 500 list 0 0 0 0 5 \, list 0 0 0 0 2 \, list 0 0 0 0 1 \,
list 0 0 0 0 4 \, list 0 0 0 0 0 \, list 0 0 0 0 3;
#X text 510 476 Text with everything present \, should emit -1;
#X text 510 360 Text with a 3 missing \, should emit 3;
#X obj 510 671 text insert mytest;
#X text 510 596 Text with a 3 and a 4 missing \, should emit only one
of these;
#X msg 510 620 list 0 0 0 0 5 \, list 0 0 0 0 2 \, list 0 0 0 0 1 \,
list 0 0 0 0 0;
#X obj 510 317 text delete mytest;
#X msg 510 293 -1;
#X text 510 267 Clear the text;
#X obj 73 521 outlet;
#X text 138 320 Change to \$1 for real \, mytest for testing;
#X text 430 90 Output number of the next tape to be used. The logic
is to search for each tape number \, and store any not found \, and
finally output whatever was last stored.;
#X obj 88 345 text search \$1 4;
#X obj 400 270 t a;
#X obj 400 415 t a;
#X obj 23 392 t a;
#X connect 0 0 17 0;
#X connect 3 0 5 0;
#X connect 3 0 19 0;
#X connect 4 0 3 0;
#X connect 5 0 3 1;
#X connect 6 0 17 0;
#X connect 7 0 12 1;
#X connect 9 0 10 0;
#X connect 10 0 7 0;
#X connect 12 0 32 0;
#X connect 16 0 4 0;
#X connect 16 1 3 1;
#X connect 16 2 36 0;
#X connect 17 0 38 0;
#X connect 17 1 16 0;
#X connect 19 0 35 0;
#X connect 19 1 7 1;
#X connect 20 0 13 0;
#X connect 23 0 22 0;
#X connect 28 0 26 0;
#X connect 30 0 29 0;
#X connect 35 0 9 0;
#X connect 36 0 37 0;
#X connect 37 0 12 1;
#X connect 38 0 12 0;
#X restore 520 590 pd get-next-tape-num;
#X obj 746 590 f 4;
#X obj 520 546 t b a b;
#X connect 2 0 4 0;
#X connect 4 0 7 0;
#X connect 4 1 12 0;
#X connect 5 0 27 0;
#X connect 6 0 39 0;
#X connect 7 1 8 0;
#X connect 8 0 17 0;
#X connect 8 1 10 0;
#X connect 10 0 5 0;
#X connect 12 0 6 1;
#X connect 12 1 5 1;
#X connect 17 0 6 0;
#X connect 20 0 21 0;
#X connect 21 0 22 0;
#X connect 22 0 23 0;
#X connect 22 0 24 0;
#X connect 23 0 25 0;
#X connect 26 0 22 1;
#X connect 27 0 34 0;
#X connect 27 1 28 0;
#X connect 27 2 13 0;
#X connect 28 0 34 2;
#X connect 29 0 18 0;
#X connect 30 0 29 0;
#X connect 30 1 31 0;
#X connect 30 2 35 0;
#X connect 31 0 18 1;
#X connect 34 0 11 0;
#X connect 35 0 18 2;
#X connect 38 0 36 1;
#X connect 39 0 30 0;
#X connect 39 1 42 0;
#X connect 40 0 36 0;
#X connect 41 0 36 2;
#X connect 42 0 40 0;
#X connect 42 1 38 0;
#X connect 42 2 41 0;
